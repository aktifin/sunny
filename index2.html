<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å°è‹±é›„æˆé•¿æ—¥å† - æ¯æ—¥ç§¯åˆ†è®°å½•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #fdf8f6; /* Warm neutral background */
            color: #44403c; /* Stone 700 */
        }

        /* Chart Container Styling - Strict adherence to requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Custom utility for calendar grid aspect ratio */
        .aspect-square {
            aspect-ratio: 1 / 1;
        }

        /* Task button transitions */
        .task-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .task-btn:active {
            transform: scale(0.98);
        }

        /* Hide scrollbar for clean UI but allow scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
    <!-- Chosen Palette: Warm Sunny Day (Warm Neutrals #fdf8f6, Orange #f97316 for energy/points, Green #22c55e for success, Stone #57534e for text) -->
    <!-- Application Structure Plan: 
         1. **Header & Context:** Introduces the "Game" (10 points daily goal). 
         2. **Dashboard (The "Today" View):** The primary interaction zone. Large, touch-friendly buttons for the 5 specific habits requested. Real-time feedback on daily score.
         3. **Calendar Grid (The "History" View):** A visual table reflecting the month. Color-coded cells based on score (High/Med/Low) to visualize streaks and consistency. Clickable to edit past days.
         4. **Analytics Section:** A line chart to show the trend of total scores over time, reinforcing the concept of "growth" and accumulation.
         5. **Summary Footer:** Displays Current Total Score to provide a long-term goal metric.
         This structure prioritizes the daily action loop while providing the retrospective data analysis requested.
    -->
    <!-- Visualization & Content Choices: 
         - **Task Toggles:** Button groups. Goal: Input. Method: HTML/JS. Justification: Fastest way for kids/parents to log data.
         - **Calendar Grid:** CSS Grid. Goal: Inform/Organize. Method: Dynamic HTML generation. Justification: Required format by user ("form of a calendar"). Visualizes gaps and streaks.
         - **Growth Chart:** Chart.js Line Chart. Goal: Trends. Method: Canvas. Justification: Shows improvement over time better than a table alone. NO SVG used.
         - **Score Cards:** Big Typography. Goal: Motivation. Method: CSS. Justification: Instant feedback on "Daily Total" and "Grand Total".
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="min-h-screen flex flex-col">

    <!-- App Container -->
    <main class="flex-grow container mx-auto px-4 py-6 max-w-4xl">
        
        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-orange-600 mb-2">ğŸŒŸ å°å°è‹±é›„æˆé•¿æ—¥å†</h1>
            <p class="text-stone-500 max-w-xl mx-auto">
                æ¬¢è¿æ¥åˆ°ä½ çš„æ¯æ—¥æŒ‘æˆ˜ï¼è¿™é‡Œè®°å½•ç€ä½ æ¯å¤©çš„è¿›æ­¥ã€‚å®Œæˆ5é¡¹æŒ‘æˆ˜ï¼Œæ¯å¤©æœ€é«˜å¯å¾— <span class="font-bold text-orange-600">10åˆ†</span>ã€‚åšæŒä¸‹å»ï¼Œç§¯æ”’ç§¯åˆ†æ¢å–å¥–åŠ±å§ï¼
            </p>
        </header>

        <!-- Top Stats Row -->
        <section class="grid grid-cols-2 gap-4 mb-8">
            <div class="bg-white rounded-2xl shadow-sm border border-orange-100 p-6 flex flex-col items-center justify-center text-center">
                <span class="text-stone-400 text-sm font-medium uppercase tracking-wider">ä»Šæ—¥å¾—åˆ†</span>
                <div class="text-5xl font-black text-orange-500 mt-2" id="display-daily-score">0</div>
                <span class="text-xs text-orange-300 font-bold mt-1">/ 10 åˆ†</span>
            </div>
            <div class="bg-white rounded-2xl shadow-sm border border-blue-100 p-6 flex flex-col items-center justify-center text-center">
                <span class="text-stone-400 text-sm font-medium uppercase tracking-wider">ç›®å‰æ€»ç§¯åˆ†</span>
                <div class="text-5xl font-black text-blue-500 mt-2" id="display-total-score">0</div>
                <span class="text-xs text-blue-300 font-bold mt-1">æŒç»­åŠ æ²¹ï¼</span>
            </div>
        </section>

        <!-- Main Interaction Area -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            
            <!-- Left Column: Daily Tasks -->
            <div class="bg-white rounded-2xl shadow-lg border border-stone-100 p-6 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 bg-orange-400"></div>
                
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-stone-700">ğŸ“ ä»Šæ—¥æŒ‘æˆ˜æ¸…å•</h2>
                    <span id="current-date-display" class="text-sm font-medium text-stone-400 bg-stone-100 px-3 py-1 rounded-full"></span>
                </div>

                <p class="text-sm text-stone-500 mb-4">ç‚¹å‡»ä¸‹åˆ—é¡¹ç›®è¿›è¡Œæ‰“å¡ã€‚æ¯é¡¹ä»»åŠ¡ä»·å€¼ <span class="font-bold text-orange-500">2åˆ†</span>ã€‚</p>

                <div class="space-y-3" id="task-list-container">
                    <!-- Tasks injected by JS -->
                </div>
            </div>

            <!-- Right Column: Analytics (Chart) -->
            <div class="bg-white rounded-2xl shadow-lg border border-stone-100 p-6 relative">
                <div class="absolute top-0 left-0 w-full h-2 bg-blue-400"></div>
                <div class="mb-4">
                    <h2 class="text-xl font-bold text-stone-700">ğŸ“ˆ ç§¯åˆ†æˆé•¿æ›²çº¿</h2>
                    <p class="text-sm text-stone-500">è§‚å¯Ÿä½ æœ€è¿‘çš„åŠªåŠ›æˆæœï¼Œä¿æŒä¸Šå‡è¶‹åŠ¿ï¼</p>
                </div>
                
                <div class="chart-container">
                    <canvas id="growthChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Bottom Section: Calendar View -->
        <section class="bg-white rounded-2xl shadow-lg border border-stone-100 p-6 mb-8 relative">
            <div class="absolute top-0 left-0 w-full h-2 bg-green-400"></div>
            
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-stone-700">ğŸ“… ç§¯åˆ†æœˆå†</h2>
                    <p class="text-sm text-stone-500">ç‚¹å‡»æ—¥å†ä¸Šçš„æ—¥æœŸå¯ä»¥è¡¥å½•æˆ–æŸ¥çœ‹å½“å¤©çš„è®°å½•ã€‚</p>
                </div>
                <div class="flex items-center gap-2 mt-4 md:mt-0">
                    <button id="prev-month" class="p-2 hover:bg-stone-100 rounded-full text-stone-400 hover:text-orange-500 transition">â—€</button>
                    <span id="calendar-month-year" class="font-bold text-lg text-stone-700 w-32 text-center"></span>
                    <button id="next-month" class="p-2 hover:bg-stone-100 rounded-full text-stone-400 hover:text-orange-500 transition">â–¶</button>
                </div>
            </div>

            <!-- Calendar Grid Header -->
            <div class="grid grid-cols-7 mb-2">
                <div class="text-center text-xs font-bold text-stone-400 py-2">æ—¥</div>
                <div class="text-center text-xs font-bold text-stone-400 py-2">ä¸€</div>
                <div class="text-center text-xs font-bold text-stone-400 py-2">äºŒ</div>
                <div class="text-center text-xs font-bold text-stone-400 py-2">ä¸‰</div>
                <div class="text-center text-xs font-bold text-stone-400 py-2">å››</div>
                <div class="text-center text-xs font-bold text-stone-400 py-2">äº”</div>
                <div class="text-center text-xs font-bold text-stone-400 py-2">å…­</div>
            </div>

            <!-- Calendar Days -->
            <div id="calendar-grid" class="grid grid-cols-7 gap-2">
                <!-- Days injected by JS -->
            </div>

            <!-- Legend -->
            <div class="flex justify-center gap-6 mt-6 text-xs text-stone-500">
                <div class="flex items-center gap-1"><div class="w-3 h-3 rounded-full bg-green-500"></div> æ»¡åˆ† (10)</div>
                <div class="flex items-center gap-1"><div class="w-3 h-3 rounded-full bg-blue-400"></div> ä¼˜ç§€ (6-8)</div>
                <div class="flex items-center gap-1"><div class="w-3 h-3 rounded-full bg-orange-300"></div> åŠ æ²¹ (1-4)</div>
                <div class="flex items-center gap-1"><div class="w-3 h-3 rounded-full bg-stone-100 border border-stone-200"></div> æ— è®°å½•</div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-stone-100 py-6 text-center">
        <p class="text-stone-400 text-sm">åšæŒå°±æ˜¯èƒœåˆ©ï¼æ¯å¤©ä¸€ç‚¹ç‚¹ï¼Œè¿›æ­¥çœ‹å¾—è§ã€‚</p>
    </footer>

    <script>
        /**
         * Application Logic
         */
        
        // 1. Configuration & Data
        const TASKS = [
            { id: 'skill', text: 'æŠ€èƒ½å­¦ä¹ ', icon: 'ğŸ“–', desc: 'é˜…è¯»ã€ç”»ç”»æˆ–ç»ƒç´' },
            { id: 'housework', text: 'å¸®åŠ©åšå®¶åŠ¡', icon: 'ğŸ§¹', desc: 'æ‰«åœ°ã€æ“¦æ¡Œå­æˆ–æ´—ç¢—' },
            { id: 'self', text: 'è‡ªå·±çš„äº‹è‡ªå·±åš', icon: 'ğŸ‘•', desc: 'ç©¿è¡£ã€æ´—æ¼±ã€æ•´ç†ä¹¦åŒ…' },
            { id: 'toys', text: 'æ•´ç†å¥½ç©å…·', icon: 'ğŸ§¸', desc: 'ç©å®Œç©å…·æ”¾å›åŸå¤„' },
            { id: 'sleep', text: 'æŒ‰æ—¶ç¡è§‰', icon: 'ğŸŒ™', desc: 'æ™šä¸Š9:00å‰ä¸ŠåºŠä¼‘æ¯' }
        ];

        const POINTS_PER_TASK = 2; // 5 tasks * 2 points = 10 max points
        
        // State
        let currentDate = new Date(); // The date currently being viewed/edited
        let displayedMonth = new Date(); // The month shown in calendar
        let chartInstance = null;

        // Mock Storage (In a real app, this would be localStorage or a database)
        // Structure: { "YYYY-MM-DD": { score: number, completedTasks: ['id1', 'id2'] } }
        let scoreData = loadData();

        function loadData() {
            const saved = localStorage.getItem('kidsScoreData');
            if (saved) return JSON.parse(saved);
            

        }

        function saveData() {
            localStorage.setItem('kidsScoreData', JSON.stringify(scoreData));
            updateUI();
        }

        // 2. Helper Functions
        function formatDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDateDisplay(date) {
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            return date.toLocaleDateString('zh-CN', options);
        }

        function isSameDay(d1, d2) {
            return d1.getFullYear() === d2.getFullYear() &&
                   d1.getMonth() === d2.getMonth() &&
                   d1.getDate() === d2.getDate();
        }

        function getDailyTotal(dateKey) {
            return scoreData[dateKey]?.score || 0;
        }

        function getCumulativeTotal() {
            return Object.values(scoreData).reduce((sum, day) => sum + (day.score || 0), 0);
        }

        // 3. Core Interaction Logic
        function toggleTask(taskId) {
            const key = formatDateKey(currentDate);
            
            // Initialize day if not exists
            if (!scoreData[key]) {
                scoreData[key] = { score: 0, completedTasks: [] };
            }

            const dayRecord = scoreData[key];
            const taskIndex = dayRecord.completedTasks.indexOf(taskId);

            if (taskIndex > -1) {
                // Remove task
                dayRecord.completedTasks.splice(taskIndex, 1);
            } else {
                // Add task
                dayRecord.completedTasks.push(taskId);
            }

            // Recalculate score
            dayRecord.score = dayRecord.completedTasks.length * POINTS_PER_TASK;

            // Save and Update
            saveData();
        }

        function setViewDate(date) {
            currentDate = new Date(date);
            updateUI();
        }

        function changeMonth(offset) {
            displayedMonth.setMonth(displayedMonth.getMonth() + offset);
            renderCalendar();
        }

        // 4. Rendering Logic
        
        function renderHeaderStats() {
            const key = formatDateKey(currentDate);
            const dailyScore = getDailyTotal(key);
            const totalScore = getCumulativeTotal();

            // Animate Numbers
            document.getElementById('display-daily-score').innerText = dailyScore;
            document.getElementById('display-total-score').innerText = totalScore;
            
            // Update Date Display
            document.getElementById('current-date-display').innerText = isSameDay(currentDate, new Date()) 
                ? `ä»Šå¤©, ${formatDateDisplay(currentDate)}` 
                : formatDateDisplay(currentDate);
        }

        function renderTaskList() {
            const container = document.getElementById('task-list-container');
            container.innerHTML = '';

            const key = formatDateKey(currentDate);
            const dayRecord = scoreData[key] || { completedTasks: [] };

            TASKS.forEach(task => {
                const isCompleted = dayRecord.completedTasks.includes(task.id);
                
                const btn = document.createElement('button');
                btn.className = `task-btn w-full flex items-center justify-between p-4 rounded-xl border-2 text-left group ${
                    isCompleted 
                    ? 'bg-orange-50 border-orange-500 shadow-md' 
                    : 'bg-white border-stone-100 hover:border-orange-200 hover:bg-stone-50'
                }`;
                
                btn.onclick = () => toggleTask(task.id);

                btn.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center text-2xl ${
                            isCompleted ? 'bg-orange-100' : 'bg-stone-100 text-stone-300'
                        }">
                            ${task.icon}
                        </div>
                        <div>
                            <div class="font-bold ${isCompleted ? 'text-orange-700' : 'text-stone-700'}">${task.text}</div>
                            <div class="text-xs text-stone-400">${task.desc}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="text-xs font-bold text-orange-400 bg-orange-50 px-2 py-1 rounded">+2åˆ†</span>
                        <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                            isCompleted ? 'bg-orange-500 border-orange-500' : 'border-stone-200'
                        }">
                            ${isCompleted ? '<span class="text-white text-xs">âœ“</span>' : ''}
                        </div>
                    </div>
                `;
                container.appendChild(btn);
            });
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            const monthLabel = document.getElementById('calendar-month-year');
            
            grid.innerHTML = '';
            
            const year = displayedMonth.getFullYear();
            const month = displayedMonth.getMonth();
            
            monthLabel.innerText = `${year}å¹´ ${month + 1}æœˆ`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay(); // 0 = Sunday

            // Padding days
            for (let i = 0; i < startingDay; i++) {
                const pad = document.createElement('div');
                grid.appendChild(pad);
            }

            // Days
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const key = formatDateKey(date);
                const record = scoreData[key];
                const score = record ? record.score : null;
                const isSelected = isSameDay(date, currentDate);
                const isToday = isSameDay(date, new Date());

                const cell = document.createElement('button');
                
                // Base classes
                let classes = "aspect-square rounded-xl flex flex-col items-center justify-center relative transition hover:brightness-95 ";
                
                // Color Logic based on Score
                if (score === 10) classes += "bg-green-500 text-white ";
                else if (score >= 6) classes += "bg-blue-400 text-white ";
                else if (score > 0) classes += "bg-orange-300 text-white ";
                else classes += "bg-stone-50 text-stone-400 border border-stone-100 ";

                // Selection highlight
                if (isSelected) {
                    classes += "ring-4 ring-orange-200 ring-offset-2 z-10 ";
                }
                
                // Today marker
                if (isToday) {
                    classes += "font-bold ";
                }

                cell.className = classes;
                cell.onclick = () => setViewDate(date);

                cell.innerHTML = `
                    <span class="text-sm">${day}</span>
                    ${score !== null ? `<span class="text-xs font-bold opacity-90">${score}</span>` : ''}
                    ${isToday && score === null ? '<span class="w-1.5 h-1.5 bg-orange-500 rounded-full absolute bottom-2"></span>' : ''}
                `;

                grid.appendChild(cell);
            }
        }

        function renderChart() {
            const ctx = document.getElementById('growthChart').getContext('2d');
            
            // Get last 7 days data relative to currentDate (or just last 7 real days)
            // Let's show the current month's progress mostly
            
            const labels = [];
            const dataPoints = [];
            
            // Show last 10 days ending at today for trend analysis
            const endD = new Date(); // Always anchor chart to real today for "Growth"
            const startD = new Date();
            startD.setDate(endD.getDate() - 9);

            for (let d = new Date(startD); d <= endD; d.setDate(d.getDate() + 1)) {
                const key = formatDateKey(d);
                labels.push(`${d.getMonth()+1}/${d.getDate()}`);
                dataPoints.push(getDailyTotal(key));
            }

            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æ¯æ—¥å¾—åˆ†',
                        data: dataPoints,
                        borderColor: '#3b82f6', // blue-500
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#2563eb',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `å¾—åˆ†: ${context.parsed.y} åˆ†`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            ticks: { stepSize: 2 },
                            grid: { color: '#f5f5f4' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function updateUI() {
            renderHeaderStats();
            renderTaskList();
            renderCalendar();
            renderChart();
        }

        // 5. Initialization
        document.addEventListener('DOMContentLoaded', () => {
            // Event Listeners for Month Nav
            document.getElementById('prev-month').addEventListener('click', () => changeMonth(-1));
            document.getElementById('next-month').addEventListener('click', () => changeMonth(1));

            updateUI();
        });

    </script>
</body>

</html>
